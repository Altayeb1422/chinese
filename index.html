<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>汉语语境通 AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.29.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
    <style>
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fadeIn {
        animation: fadeIn 0.5s ease-out forwards;
      }
      .perspective {
        perspective: 1000px;
      }
      .card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s;
        transform-style: preserve-3d;
      }
      .card-flipped .card-inner {
        transform: rotateY(180deg);
      }
      .card-front,
      .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
        text-align: center;
      }
      .card-back {
        transform: rotateY(180deg);
      }
    </style>
  </head>
  <body class="bg-slate-950 text-slate-200">
    <div id="root"></div>
    <script type="module">
      import React, { useState, useEffect, useCallback } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI, Type, Modality } from "@google/genai";

      // --- START OF INLINED: utils/audioUtils.ts ---
      let audioContext = null;
      const getAudioContext = () => {
          if (!audioContext) {
              audioContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 24000 });
          }
          return audioContext;
      };

      function decode(base64) {
          const binaryString = window.atob(base64);
          const len = binaryString.length;
          const bytes = new Uint8Array(len);
          for (let i = 0; i < len; i++) {
              bytes[i] = binaryString.charCodeAt(i);
          }
          return bytes;
      }

      async function decodeAudioData(data, ctx, sampleRate, numChannels) {
          const dataInt16 = new Int16Array(data.buffer);
          const frameCount = dataInt16.length / numChannels;
          const buffer = ctx.createBuffer(numChannels, frameCount, sampleRate);

          for (let channel = 0; channel < numChannels; channel++) {
              const channelData = buffer.getChannelData(channel);
              for (let i = 0; i < frameCount; i++) {
                  channelData[i] = dataInt16[i * numChannels + channel] / 32768.0;
              }
          }
          return buffer;
      }

      const playAudio = async (base64Audio) => {
          try {
              const ctx = getAudioContext();
              if (ctx.state === 'suspended') {
                  await ctx.resume();
              }
              const decodedBytes = decode(base64Audio);
              const audioBuffer = await decodeAudioData(decodedBytes, ctx, 24000, 1);

              const source = ctx.createBufferSource();
              source.buffer = audioBuffer;
              source.connect(ctx.destination);
              source.start();
          } catch (error) {
              console.error("播放音频失败:", error);
          }
      };
      // --- END OF INLINED: utils/audioUtils.ts ---

      // --- START OF INLINED: services/geminiService.ts ---
      const getAi = () => new GoogleGenAI({apiKey: process.env.API_KEY});

      const checkExpression = async (expression) => {
          const ai = getAi();
          const model = 'gemini-2.5-flash';

          const prompt = `
            你是一位顶尖的汉语语言学家和教育家，拥有多年对外汉语教学经验，尤其擅长帮助高级学习者突破瓶颈，使其语言表达能力达到准母语水平。

            请对以下用户提供的中文句子进行一次“深度诊断与优化”：
            句子: "${expression}"

            请严格按照以下步骤和JSON格式进行分析，所有解释都必须使用清晰、易懂的中文：

            1.  **原句深度分析 (yuanju_fenxi)**:
                -   对原句进行全面、深入的分析。请将分析清晰地分为以下几个方面：
                -   **zongti (总体评价)**: 对句子的总体评价和核心问题总结。
                -   **yufa (语法)**: (可选) 语法方面的具体分析和建议。
                -   **cihui (词汇)**: (可选) 词汇选择和搭配方面的具体分析和建议。
                -   **yuti (语体与风格)**: (可选) 语体、风格或文化语境方面的具体分析和建议。
                -   即使句子语法完全正确，也要在“总体评价”中探讨其表达是否平淡、生硬，或者听起来像“教科书中文”。如果某个可选方面没有问题，可以省略该字段。

            2.  **核心优化建议 (tishang_biaoda)**:
                -   提供一个核心的“提升版”建议。这个版本应该在用词上更精妙、句式上更地道、表达上更优雅，但同时保持自然、不做作，是高水平母语者在相应情境下会使用的表达。
                -   **biaoda**: 提升后的句子。
                -   **pinyin**: 提升后句子的带声调拼音。
                -   **fenxi**: 详细分析为什么这个版本更好，具体解释它在哪些方面（如词汇、结构、语气）超越了原句。

            3.  **更多地道说法 (tihuan_biaoda)**:
                -   提供一个包含2-3个其他地道表达的列表。这些表达可以适用于不同但相关的语境（例如，更口语化、更正式或带有不同情感色彩的说法）。
                -   对于每一个说法：
                    -   **biaoda**: 另一个地道的句子。
                    -   **pinyin**: 该句子的拼音。
                    -   **shuoming**: 简要说明该表达的特点、适用语境或与核心建议的细微差别。

            请确保你的输出是严格符合以下定义的JSON对象。
          `;

          const responseSchema = {
              type: Type.OBJECT,
              properties: {
                  yuanju_fenxi: { 
                      type: Type.OBJECT, 
                      description: "对用户原始句子的深入、详细的分类语言学分析。",
                      properties: {
                        zongti: { type: Type.STRING, description: "对句子的总体评价和核心问题总结。" },
                        yufa: { type: Type.STRING, description: "语法方面的具体分析和建议。" },
                        cihui: { type: Type.STRING, description: "词汇选择和搭配方面的具体分析和建议。" },
                        yuti: { type: Type.STRING, description: "语体、风格或文化语境方面的具体分析和建议。" }
                      },
                      required: ["zongti"]
                  },
                  tishang_biaoda: {
                      type: Type.OBJECT,
                      description: "一个核心的、表达更优雅且地道的优化建议。",
                      properties: {
                          biaoda: { type: Type.STRING, description: "提升后的句子。" },
                          pinyin: { type: Type.STRING, description: "提升后句子的带声调拼音。" },
                          fenxi: { type: Type.STRING, description: "详细分析为什么这个提升版更好。" }
                      },
                      required: ["biaoda", "pinyin", "fenxi"]
                  },
                  tihuan_biaoda: {
                      type: Type.ARRAY,
                      description: "一个包含多个其他地道表达方式的列表。",
                      items: {
                          type: Type.OBJECT,
                          properties: {
                              biaoda: { type: Type.STRING, description: "另一个地道的表达。" },
                              pinyin: { type: Type.STRING, description: "该表达的拼音。" },
                              shuoming: { type: Type.STRING, description: "关于该表达适用语境或特点的简要说明。" }
                          },
                          required: ["biaoda", "pinyin", "shuoming"]
                      }
                  }
              },
              required: ["yuanju_fenxi", "tishang_biaoda", "tihuan_biaoda"],
          };

          try {
              const result = await ai.models.generateContent({
                  model: model,
                  contents: prompt,
                  config: {
                      responseMimeType: "application/json",
                      responseSchema: responseSchema,
                  },
              });

              const jsonString = result.text.trim();
              const parsedResult = JSON.parse(jsonString);
              return { ...parsedResult, yuanju: expression };
          } catch (error) {
              console.error("检查表达时出错:", error);
              throw new Error("无法检查表达，请重试。");
          }
      };

      const getBreakdown = async (sentence) => {
          const ai = getAi();
          const model = 'gemini-2.5-flash';
          const prompt = `
              你是一位专业的、富有洞察力的汉语教师。请对以下句子进行全面的深度解析。
              句子: "${sentence}"

              你的任务分为两个部分：

              第一部分：对整个句子进行综合分析。
              1.  **拼音 (pinyin)**: 提供整个句子的标准拼音，带声调。
              2.  **释义 (jieshi)**: 用清晰的中文解释整个句子的含义和语境。
              3.  **相似例句 (liju)**: 提供一个结构相似或意思相近的例句，帮助理解用法。
              4.  **补充信息 (buchong)**: （可选）提供关于语法结构、文化背景或表达方式的额外见解。

              第二部分：将句子分解为其核心的词语或短语。
              -   对于每一个核心词语/短语，请提供它的拼音、一个简单的中文解释，以及一个使用该词语/短语的例句。

              请严格按照以下JSON格式返回结果，所有字段都必须使用中文。
          `;

          const responseSchema = {
              type: Type.OBJECT,
              properties: {
                  sentenceAnalysis: {
                      type: Type.OBJECT,
                      properties: {
                          pinyin: { type: Type.STRING, description: "整个句子的拼音。" },
                          jieshi: { type: Type.STRING, description: "整个句子的中文释义。" },
                          liju: { type: Type.STRING, description: "一个与原句结构或意思相似的例句。" },
                          buchong: { type: Type.STRING, description: "关于句子语法或文化背景的补充信息。" },
                      },
                      required: ["pinyin", "jieshi", "liju"]
                  },
                  wordBreakdowns: {
                      type: Type.ARRAY,
                      items: {
                          type: Type.OBJECT,
                          properties: {
                              ciyu: { type: Type.STRING, description: "核心词语或短语。" },
                              pinyin: { type: Type.STRING, description: "该词语的拼音。" },
                              jieshi: { type: Type.STRING, description: "对该词语的简单中文解释。" },
                              liju: { type: Type.STRING, description: "一个使用该词语的例句。" },
                          },
                          required: ["ciyu", "pinyin", "jieshi", "liju"]
                      }
                  }
              },
              required: ["sentenceAnalysis", "wordBreakdowns"]
          };

          try {
              const result = await ai.models.generateContent({
                  model: model,
                  contents: prompt,
                  config: {
                      responseMimeType: "application/json",
                      responseSchema: responseSchema,
                  },
              });
              const jsonString = result.text.trim();
              const parsedResult = JSON.parse(jsonString);
              parsedResult.sentenceAnalysis.yuanju = sentence;
              return parsedResult;
          } catch (error) {
              console.error("解析句子时出错:", error);
              throw new Error("无法解析句子，请重试。");
          }
      };

      const getPronunciationAudio = async (text) => {
          if (!text || text.trim() === '') {
              throw new Error("Cannot generate audio for empty text.");
          }
          const ai = getAi();
          try {
              const response = await ai.models.generateContent({
                  model: "gemini-2.5-flash-preview-tts",
                  contents: { parts: [{ text: `朗读: ${text}` }] },
                  config: {
                      responseModalities: [Modality.AUDIO],
                      speechConfig: {
                          voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: 'Zephyr' }, 
                          },
                      },
                  },
              });

              const base64Audio = response.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
              if (!base64Audio) {
                  throw new Error("API未返回音频数据。");
              }
              return base64Audio;
          } catch (error) {
              console.error("生成发音音频时出错:", error);
              throw new Error("未能生成音频。");
          }
      };
      // --- END OF INLINED: services/geminiService.ts ---

      // --- START OF INLINED: hooks/useStudyList.ts ---
      const useStudyList = () => {
          const [studyList, setStudyList] = useState([]);
          const [loading, setLoading] = useState(true);
          const STORAGE_KEY = 'studyList_zh';

          useEffect(() => {
              try {
                  const items = localStorage.getItem(STORAGE_KEY);
                  if (items) {
                      setStudyList(JSON.parse(items));
                  }
              } catch (error) {
                  console.error("从本地存储加载学习列表失败", error);
              } finally {
                  setLoading(false);
              }
          }, []);

          const saveToLocalStorage = (items) => {
              try {
                  localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
              } catch (error) {
                  console.error("保存学习列表到本地存储失败", error);
              }
          };

          const addStudyItem = useCallback((biaoda, jieshi) => {
              setStudyList(prevList => {
                  const isDuplicate = prevList.some(item => item.biaoda.toLowerCase() === biaoda.toLowerCase());
                  if (isDuplicate) {
                      return prevList;
                  }
                  const newItem = {
                      id: new Date().toISOString(),
                      biaoda,
                      jieshi,
                      createdAt: new Date().toISOString(),
                  };
                  const updatedList = [newItem, ...prevList];
                  saveToLocalStorage(updatedList);
                  return updatedList;
              });
          }, []);
          
          const isExpressionInList = useCallback((biaoda) => {
              return studyList.some(item => item.biaoda.toLowerCase() === biaoda.toLowerCase());
          }, [studyList]);

          const removeStudyItem = useCallback((id) => {
              setStudyList(prevList => {
                  const updatedList = prevList.filter(item => item.id !== id);
                  saveToLocalStorage(updatedList);
                  return updatedList;
              });
          }, []);

          return { studyList, addStudyItem, removeStudyItem, isExpressionInList, loading };
      };
      // --- END OF INLINED: hooks/useStudyList.ts ---

      // --- START OF INLINED: components/icons/*.tsx ---
      const SpeakerIcon = () => (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" })
          )
      );
      const PlusIcon = ({ added = false }) => {
        if (added) {
          return (
            React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 13l4 4L19 7" })
            )
          );
        }
        return (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
            React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 6v6m0 0v6m0-6h6m-6 0H6" })
          )
        );
      };
      const Spinner = () => (
        React.createElement('svg', { className: "animate-spin h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
          React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
          React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
        )
      );
      const Pencil = () => (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" })
          )
      );
      const BookOpen = () => (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" })
          )
      );
      const Brain = () => (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2 },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 8h6m-3 10v-6m-4 4h8a4 4 0 004-4V8a4 4 0 00-4-4H9a4 4 0 00-4 4v6a4 4 0 004 4zm-2-9a.5.5 0 01.5-.5h1a.5.5 0 01.5.5v1a.5.5 0 01-.5.5h-1a.5.5 0 01-.5-.5v-1zm5 0a.5.5 0 01.5-.5h1a.5.5 0 01.5.5v1a.5.5 0 01-.5.5h-1a.5.5 0 01-.5-.5v-1z" })
          )
      );
      // --- END OF INLINED: components/icons/*.tsx ---
      
      // --- START OF INLINED: components/ExpressionChecker.tsx ---
      const ExpressionChecker = ({ addStudyItem, isExpressionInList }) => {
          const [input, setInput] = useState('');
          const [result, setResult] = useState(null);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);
          const [audioLoading, setAudioLoading] = useState(null);

          const handleSubmit = async (e) => {
              e.preventDefault();
              if (!input.trim()) return;
              setLoading(true);
              setError(null);
              setResult(null);
              try {
                  const checkResult = await checkExpression(input);
                  setResult(checkResult);
              } catch (err) {
                  setError(err.message || '发生未知错误。');
              } finally {
                  setLoading(false);
              }
          };

          const handlePlayAudio = async (text) => {
              setAudioLoading(text);
              try {
                  const audioData = await getPronunciationAudio(text);
                  await playAudio(audioData);
              } catch (error) {
                  console.error("播放音频时出错", error);
                  alert("未能播放音频。");
              } finally {
                  setAudioLoading(null);
              }
          };
          
          const AnalysisCategory = ({ title, content }) => {
              if (!content) return null;
              return React.createElement('div', null,
                  React.createElement('h4', { className: "font-semibold text-slate-400 text-sm mb-1" }, title),
                  React.createElement('p', { className: "text-slate-300 whitespace-pre-wrap leading-relaxed" }, content)
              );
          };

          return React.createElement('div', { className: "p-4 md:p-6" },
              React.createElement('h2', { className: "text-2xl font-bold mb-4 text-slate-100" }, "表达优化"),
              React.createElement('p', { className: "mb-4 text-slate-400" }, "输入您不确定的句子或表达，AI将进行深度分析并提供母语级的优化建议。"),
              React.createElement('form', { onSubmit: handleSubmit, className: "flex flex-col sm:flex-row gap-2 mb-6" },
                  React.createElement('textarea', {
                      value: input,
                      onChange: (e) => setInput(e.target.value),
                      placeholder: "例如：我的爱好是玩电脑游戏。",
                      className: "flex-grow p-3 bg-slate-800 border border-slate-700 rounded-md focus:ring-2 focus:ring-violet-500 focus:outline-none transition text-slate-200 placeholder:text-slate-500",
                      rows: 2
                  }),
                  React.createElement('button', {
                      type: "submit",
                      disabled: loading,
                      className: "bg-violet-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-violet-700 disabled:bg-violet-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
                  }, loading ? React.createElement(Spinner) : '分析')
              ),
              error && React.createElement('div', { className: "bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-md mb-4", role: "alert" }, error),
              result && React.createElement('div', { className: "space-y-8 animate-fadeIn" },
                  React.createElement('div', { className: "bg-slate-800/50 p-6 rounded-lg shadow-lg border border-slate-700" },
                      React.createElement('h3', { className: "font-bold text-lg text-slate-100 mb-4" }, "原句诊断报告"),
                      React.createElement('p', { className: "text-slate-300 italic text-lg mb-4 bg-slate-900/50 p-3 rounded-md" }, `"${result.yuanju}"`),
                      React.createElement('div', { className: "space-y-4" },
                          React.createElement(AnalysisCategory, { title: "总体评价", content: result.yuanju_fenxi.zongti }),
                          React.createElement(AnalysisCategory, { title: "语法分析", content: result.yuanju_fenxi.yufa }),
                          React.createElement(AnalysisCategory, { title: "词汇建议", content: result.yuanju_fenxi.cihui }),
                          React.createElement(AnalysisCategory, { title: "语体与风格", content: result.yuanju_fenxi.yuti })
                      )
                  ),
                  React.createElement('div', { className: "bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-lg shadow-lg border border-cyan-500/50" },
                      React.createElement('h3', { className: "text-xl font-bold text-slate-100 mb-4" }, "核心优化建议"),
                      React.createElement('div', { className: "flex items-center gap-4" },
                          React.createElement('p', { className: "text-cyan-400 font-bold text-2xl tracking-wide" }, `"${result.tishang_biaoda.biaoda}"`),
                          React.createElement('button', { onClick: () => handlePlayAudio(result.tishang_biaoda.biaoda), disabled: audioLoading === result.tishang_biaoda.biaoda, className: "text-slate-400 hover:text-cyan-400 transition-colors" },
                              audioLoading === result.tishang_biaoda.biaoda ? React.createElement(Spinner) : React.createElement(SpeakerIcon)
                          )
                      ),
                      React.createElement('p', { className: "text-violet-300 text-md font-mono mt-2" }, result.tishang_biaoda.pinyin),
                      React.createElement('div', { className: "mt-4 pt-4 border-t border-slate-700" },
                          React.createElement('h4', { className: "font-semibold text-slate-300 text-md mb-2" }, "优化解析"),
                          React.createElement('p', { className: "text-slate-300 whitespace-pre-wrap leading-relaxed mb-6" }, result.tishang_biaoda.fenxi),
                          React.createElement('button', { 
                              onClick: () => addStudyItem(result.tishang_biaoda.biaoda, result.tishang_biaoda.fenxi),
                              disabled: isExpressionInList(result.tishang_biaoda.biaoda),
                              className: "flex items-center gap-2 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:bg-slate-600 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-green-500 transition-colors"
                          },
                              React.createElement(PlusIcon, { added: isExpressionInList(result.tishang_biaoda.biaoda) }),
                              isExpressionInList(result.tishang_biaoda.biaoda) ? '已收藏' : '收藏该表达'
                          )
                      )
                  ),
                  React.createElement('div', null,
                      React.createElement('h3', { className: "text-xl font-bold mb-4 text-slate-100" }, "更多地道说法"),
                      React.createElement('div', { className: "space-y-4" },
                          result.tihuan_biaoda.map((alt, index) =>
                              React.createElement('div', { key: index, className: "bg-slate-800/50 p-4 rounded-lg border border-slate-700" },
                                  React.createElement('div', { className: "flex justify-between items-start gap-4" },
                                      React.createElement('div', { className: "flex-grow" },
                                          React.createElement('div', { className: "flex items-center gap-3 mb-1" },
                                              React.createElement('p', { className: "text-slate-200 font-semibold text-lg" }, `"${alt.biaoda}"`),
                                              React.createElement('button', { onClick: () => handlePlayAudio(alt.biaoda), disabled: audioLoading === alt.biaoda, className: "text-slate-400 hover:text-cyan-400 transition-colors" },
                                                  audioLoading === alt.biaoda ? React.createElement(Spinner) : React.createElement(SpeakerIcon)
                                              )
                                          ),
                                          React.createElement('p', { className: "text-violet-300 text-sm font-mono" }, alt.pinyin)
                                      ),
                                      React.createElement('button', { 
                                          onClick: () => addStudyItem(alt.biaoda, alt.shuoming),
                                          disabled: isExpressionInList(alt.biaoda),
                                          className: "flex-shrink-0 flex items-center gap-2 px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600/80 hover:bg-green-700 disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors",
                                          'aria-label': isExpressionInList(alt.biaoda) ? '已收藏' : '收藏'
                                      },
                                          React.createElement(PlusIcon, { added: isExpressionInList(alt.biaoda) }),
                                          React.createElement('span', null, isExpressionInList(alt.biaoda) ? '已收藏' : '收藏')
                                      )
                                  ),
                                  React.createElement('p', { className: "text-slate-400 mt-2 text-sm leading-relaxed border-t border-slate-700/50 pt-2" }, 
                                      React.createElement('span', {className: 'font-semibold'}, "语境说明："), 
                                      alt.shuoming)
                              )
                          )
                      )
                  )
              )
          );
      };
      // --- END OF INLINED: components/ExpressionChecker.tsx ---

      // --- START OF INLINED: components/BreakdownTool.tsx ---
      const BreakdownTool = ({ addStudyItem, isExpressionInList }) => {
          const [input, setInput] = useState('');
          const [analysisResult, setAnalysisResult] = useState(null);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);
          const [audioLoading, setAudioLoading] = useState(null);

          const handleSubmit = async (e) => {
              e.preventDefault();
              if (!input.trim()) return;
              setLoading(true);
              setError(null);
              setAnalysisResult(null);
              try {
                  const result = await getBreakdown(input);
                  setAnalysisResult(result);
              } catch (err) {
                  setError(err.message || '发生未知错误。');
              } finally {
                  setLoading(false);
              }
          };
          
          const handlePlayAudio = async (text) => {
              setAudioLoading(text);
              try {
                  const audioData = await getPronunciationAudio(text);
                  await playAudio(audioData);
              } catch (error) {
                  console.error("播放音频时出错", error);
                  alert("未能播放音频。");
              } finally {
                  setAudioLoading(null);
              }
          };

          return React.createElement('div', { className: "p-4 md:p-6" },
              React.createElement('h2', { className: "text-2xl font-bold mb-4 text-slate-100" }, "难句解析"),
              React.createElement('p', { className: "mb-4 text-slate-400" }, "输入一个复杂的句子，AI会将其分解为核心词汇、拼音、释义和例句。"),
              React.createElement('form', { onSubmit: handleSubmit, className: "flex flex-col sm:flex-row gap-2 mb-6" },
                  React.createElement('input', {
                      type: "text",
                      value: input,
                      onChange: (e) => setInput(e.target.value),
                      placeholder: "例如：这个问题的解决方案需要我们从长计议。",
                      className: "flex-grow p-3 bg-slate-800 border border-slate-700 rounded-md focus:ring-2 focus:ring-violet-500 focus:outline-none transition text-slate-200 placeholder:text-slate-500"
                  }),
                  React.createElement('button', {
                      type: "submit",
                      disabled: loading,
                      className: "bg-violet-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-violet-700 disabled:bg-violet-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
                  }, loading ? React.createElement(Spinner) : '解析')
              ),
              error && React.createElement('div', { className: "bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-md mb-4", role: "alert" }, error),
              analysisResult && React.createElement('div', { className: "space-y-8 animate-fadeIn" },
                  React.createElement('div', { className: "bg-slate-800/50 p-6 rounded-lg shadow-lg border border-slate-700" },
                      React.createElement('h3', { className: "text-xl font-bold mb-4 text-slate-100" }, "整句分析"),
                      React.createElement('div', { className: "mb-4" },
                          React.createElement('h4', { className: "font-semibold text-slate-400 text-sm" }, "您输入的句子"),
                          React.createElement('div', { className: "flex items-center gap-4 mt-1" },
                              React.createElement('p', { className: "text-cyan-400 font-semibold text-lg" }, `"${analysisResult.sentenceAnalysis.yuanju}"`),
                              React.createElement('button', { 
                                  onClick: () => handlePlayAudio(analysisResult.sentenceAnalysis.yuanju), 
                                  disabled: audioLoading === analysisResult.sentenceAnalysis.yuanju, 
                                  className: "text-slate-400 hover:text-cyan-400 transition-colors",
                                  'aria-label': "播放原句"
                              }, audioLoading === analysisResult.sentenceAnalysis.yuanju ? React.createElement(Spinner) : React.createElement(SpeakerIcon))
                          ),
                          React.createElement('p', { className: "text-violet-300 text-md font-mono mt-1" }, analysisResult.sentenceAnalysis.pinyin)
                      ),
                      React.createElement('div', { className: "space-y-4" },
                          React.createElement('div', null,
                              React.createElement('h4', { className: "font-semibold text-slate-400 text-sm" }, "释义"),
                              React.createElement('p', { className: "text-slate-300 mt-1 whitespace-pre-wrap leading-relaxed" }, analysisResult.sentenceAnalysis.jieshi)
                          ),
                          React.createElement('div', null,
                              React.createElement('h4', { className: "font-semibold text-slate-400 text-sm" }, "相似例句"),
                              React.createElement('p', { className: "text-slate-400 mt-1 italic" }, `"${analysisResult.sentenceAnalysis.liju}"`)
                          ),
                          analysisResult.sentenceAnalysis.buchong && React.createElement('div', null,
                              React.createElement('h4', { className: "font-semibold text-slate-400 text-sm" }, "补充信息"),
                              React.createElement('p', { className: "text-slate-300 mt-1 whitespace-pre-wrap leading-relaxed" }, analysisResult.sentenceAnalysis.buchong)
                          )
                      ),
                       React.createElement('div', { className: "mt-6 pt-4 border-t border-slate-700/50" },
                           React.createElement('button', {
                              onClick: () => addStudyItem(analysisResult.sentenceAnalysis.yuanju, analysisResult.sentenceAnalysis.jieshi),
                              disabled: isExpressionInList(analysisResult.sentenceAnalysis.yuanju),
                              className: "flex items-center gap-2 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:bg-slate-600 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-green-500 transition-colors"
                          },
                              React.createElement(PlusIcon, { added: isExpressionInList(analysisResult.sentenceAnalysis.yuanju) }),
                              isExpressionInList(analysisResult.sentenceAnalysis.yuanju) ? '整句已收藏' : '收藏整句'
                          )
                      )
                  ),
                  analysisResult.wordBreakdowns && analysisResult.wordBreakdowns.length > 0 && React.createElement('div', null,
                      React.createElement('h3', { className: "text-xl font-bold mb-4 text-slate-100" }, "核心词语解析"),
                      React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                          analysisResult.wordBreakdowns.map((item, index) =>
                              React.createElement('div', { key: index, className: "bg-slate-800/50 p-4 rounded-lg shadow-lg border border-slate-700 flex flex-col" },
                                  React.createElement('div', { className: "flex justify-between items-start mb-3" },
                                      React.createElement('div', null,
                                          React.createElement('div', { className: "flex items-center gap-3" },
                                              React.createElement('h4', { className: "text-lg font-bold text-cyan-400" }, item.ciyu),
                                              React.createElement('button', { onClick: () => handlePlayAudio(item.ciyu), disabled: audioLoading === item.ciyu, className: "text-slate-400 hover:text-cyan-400 transition-colors" },
                                                  audioLoading === item.ciyu ? React.createElement(Spinner) : React.createElement(SpeakerIcon)
                                              )
                                          ),
                                          React.createElement('p', { className: "text-sm text-violet-300 font-mono" }, item.pinyin)
                                      ),
                                      React.createElement('button', {
                                          onClick: () => addStudyItem(item.ciyu, item.jieshi),
                                          disabled: isExpressionInList(item.ciyu),
                                          className: "flex-shrink-0 flex items-center gap-2 px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors",
                                          'aria-label': isExpressionInList(item.ciyu) ? '已收藏' : '收藏'
                                      },
                                          React.createElement(PlusIcon, { added: isExpressionInList(item.ciyu) })
                                      )
                                  ),
                                  React.createElement('div', { className: "flex-grow space-y-2" },
                                      React.createElement('p', { className: "text-slate-300 text-sm" }, 
                                          React.createElement('span', { className: "font-semibold text-slate-400" }, "释义："), 
                                          ` ${item.jieshi}`),
                                      React.createElement('p', { className: "text-slate-400 text-sm italic" }, 
                                          React.createElement('span', { className: "font-semibold not-italic text-slate-500" }, "例句："), 
                                          ` "${item.liju}"`)
                                  )
                              )
                          )
                      )
                  )
              )
          );
      };
      // --- END OF INLINED: components/BreakdownTool.tsx ---

      // --- START OF INLINED: components/IntelligentReview.tsx ---
      const IntelligentReview = ({ studyList, removeStudyItem }) => {
          const [isQuizMode, setIsQuizMode] = useState(false);
          const [shuffledList, setShuffledList] = useState([]);
          const [currentIndex, setCurrentIndex] = useState(0);
          const [isFlipped, setIsFlipped] = useState(false);
          const [audioLoading, setAudioLoading] = useState(false);
          
          const shuffleArray = (array) => {
              const newArray = [...array];
              for (let i = newArray.length - 1; i > 0; i--) {
                  const j = Math.floor(Math.random() * (i + 1));
                  [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
              }
              return newArray;
          };

          const startQuiz = () => {
              if (studyList.length > 0) {
                  setShuffledList(shuffleArray(studyList));
                  setCurrentIndex(0);
                  setIsFlipped(false);
                  setIsQuizMode(true);
              }
          };
          
          const endQuiz = () => setIsQuizMode(false);

          const handleNextCard = () => {
              if (currentIndex < shuffledList.length - 1) {
                  setCurrentIndex(prev => {
                      setTimeout(() => setIsFlipped(false), 300);
                      return prev + 1;
                  });
              } else {
                  endQuiz();
                  alert("复习完成！");
              }
          };

          const handlePlayAudio = async (text) => {
              setAudioLoading(true);
              try {
                  const audioData = await getPronunciationAudio(text);
                  await playAudio(audioData);
              } catch (error) {
                  console.error("播放音频时出错", error);
                  alert("未能播放音频。");
              } finally {
                  setAudioLoading(false);
              }
          };

          const currentItem = isQuizMode ? shuffledList[currentIndex] : null;

          if (studyList.length === 0) {
              return React.createElement('div', { className: "p-4 md:p-6 text-center" },
                  React.createElement('h2', { className: "text-2xl font-bold mb-4 text-slate-100" }, "智能复习"),
                  React.createElement('p', { className: "text-slate-400" }, "你的生词本是空的。快去添加一些表达或词语来开始复习吧！")
              );
          }
          
          if (isQuizMode && currentItem) {
              return React.createElement('div', { className: "p-4 md:p-6 flex flex-col items-center" },
                  React.createElement('h2', { className: "text-2xl font-bold mb-4 text-slate-100" }, "智能复习"),
                  React.createElement('div', { className: "w-full max-w-lg mb-4 text-slate-400 text-center" },
                      React.createElement('p', null, `第 ${currentIndex + 1} / ${shuffledList.length} 张卡片`)
                  ),
                  React.createElement('div', { className: `perspective w-full max-w-lg h-64 mb-6 ${isFlipped ? 'card-flipped' : ''}` },
                      React.createElement('div', { className: "card-inner" },
                          React.createElement('div', { className: "card-front bg-slate-800 border border-slate-700 rounded-lg shadow-lg" },
                              React.createElement('p', { className: "text-slate-400 mb-2 text-sm" }, "这是什么表达？"),
                              React.createElement('p', { className: "text-xl text-slate-200" }, currentItem.jieshi)
                          ),
                          React.createElement('div', { className: "card-back bg-slate-800 border border-cyan-500/50 rounded-lg shadow-lg" },
                              React.createElement('p', { className: "text-3xl font-bold text-cyan-400 mb-2" }, currentItem.biaoda),
                              React.createElement('button', { onClick: () => handlePlayAudio(currentItem.biaoda), disabled: audioLoading, className: "text-slate-400 hover:text-cyan-400 mx-auto transition-colors" },
                                  audioLoading ? React.createElement(Spinner) : React.createElement(SpeakerIcon)
                              )
                          )
                      )
                  ),
                  React.createElement('div', { className: "flex gap-4" },
                      React.createElement('button', { onClick: endQuiz, className: "px-6 py-2 rounded-md bg-slate-600 hover:bg-slate-700 transition-colors" }, "结束复习"),
                      !isFlipped ? 
                          React.createElement('button', { onClick: () => setIsFlipped(true), className: "px-6 py-2 rounded-md bg-violet-600 hover:bg-violet-700 transition-colors font-semibold" }, "显示答案") :
                          React.createElement('button', { onClick: handleNextCard, className: "px-6 py-2 rounded-md bg-green-600 hover:bg-green-700 transition-colors font-semibold" }, "下一个")
                  )
              );
          }

          return React.createElement('div', { className: "p-4 md:p-6" },
              React.createElement('h2', { className: "text-2xl font-bold mb-4 text-slate-100" }, "智能复习"),
              React.createElement('div', { className: "text-center mb-6" },
                   React.createElement('button', { onClick: startQuiz, className: "bg-violet-600 text-white px-8 py-3 rounded-lg font-bold text-lg hover:bg-violet-700 transition-transform hover:scale-105" },
                      `开始复习 (${studyList.length} 个词条)`
                  )
              ),
              React.createElement('h3', { className: "text-xl font-semibold mb-3 text-slate-300" }, "我的生词本"),
              React.createElement('div', { className: "space-y-3" },
                  studyList.map((item) =>
                      React.createElement('div', { key: item.id, className: "bg-slate-800/50 p-4 rounded-lg shadow-md border border-slate-700/50" },
                          React.createElement('div', { className: "flex justify-between items-start" },
                              React.createElement('div', null,
                                  React.createElement('h4', { className: "text-lg font-bold text-cyan-400" }, item.biaoda),
                                  React.createElement('p', { className: "mt-1 text-slate-300 text-sm leading-relaxed" }, item.jieshi)
                              ),
                               React.createElement('button', {
                                  onClick: () => removeStudyItem(item.id),
                                  className: "text-sm text-red-500 hover:text-red-400 font-semibold transition-colors flex-shrink-0 ml-4"
                              }, "移除")
                          )
                      )
                  )
              )
          );
      };
      // --- END OF INLINED: components/IntelligentReview.tsx ---

      // --- START OF INLINED: App.tsx ---
      const App = () => {
          const [activeTab, setActiveTab] = useState('checker');
          const { studyList, addStudyItem, removeStudyItem, isExpressionInList, loading } = useStudyList();

          const renderContent = () => {
              switch (activeTab) {
                  case 'checker':
                      return React.createElement(ExpressionChecker, { addStudyItem, isExpressionInList });
                  case 'breakdown':
                      return React.createElement(BreakdownTool, { addStudyItem, isExpressionInList });
                  case 'review':
                      return React.createElement(IntelligentReview, { studyList, removeStudyItem });
                  default:
                      return null;
              }
          };
          
          const NavButton = ({tab, label, children}) => {
              const isActive = activeTab === tab;
              return (
                  React.createElement('button', {
                      onClick: () => setActiveTab(tab),
                      className: `flex flex-col items-center justify-center p-2 rounded-lg transition-colors w-28 ${isActive ? 'bg-violet-700 text-white' : 'text-slate-400 hover:bg-slate-700'}`
                  },
                      children,
                      React.createElement('span', { className: "text-xs mt-1" }, label)
                  )
              )
          };

          return (
              React.createElement('div', { className: "flex flex-col h-screen bg-gradient-to-b from-slate-900 to-slate-950 font-sans text-slate-200" },
                  React.createElement('header', { className: "bg-slate-900/50 backdrop-blur-sm border-b border-slate-700/50 p-4 sticky top-0 z-10" },
                      React.createElement('h1', { className: "text-3xl font-bold text-center text-slate-100" }, "汉语语境通 AI")
                  ),
                  React.createElement('main', { className: "flex-grow overflow-y-auto" },
                      React.createElement('div', { className: "max-w-4xl mx-auto" },
                          renderContent()
                      )
                  ),
                  React.createElement('footer', { className: "bg-slate-900/80 backdrop-blur-sm border-t border-slate-700/50 p-2 sticky bottom-0" },
                      React.createElement('nav', { className: "flex justify-around max-w-md mx-auto" },
                          React.createElement(NavButton, { tab: "checker", label: "表达优化" }, React.createElement(Pencil)),
                          React.createElement(NavButton, { tab: "breakdown", label: "难句解析" }, React.createElement(BookOpen)),
                          React.createElement(NavButton, { tab: "review", label: "智能复习" }, React.createElement(Brain))
                      )
                  )
              )
          );
      };
      // --- END OF INLINED: App.tsx ---

      // --- START OF INLINED: index.tsx ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        React.createElement(React.StrictMode, null, React.createElement(App))
      );
      // --- END OF INLINED: index.tsx ---
    </script>
  </body>
</html>

